import React, {useEffect, useState} from 'react'
import {useHistory} from 'react-router-dom'
import CIcon from '@coreui/icons-react'
import bodeverde from '../../assets/images/bode_verde.jpg';

import UseAuth from "../../context/hooks/UseAuth";
import Toaster from "../util/Toaster";


const Login = () => {
    const history = useHistory();
    const {authenticated, handleLogin} = UseAuth();
    const [user, setUser] = useState({});
    const [toasts, setToasts]= useState([])

    const onChangeUsername = (e) => {
        setUser({...user, login: e.target.value});
    }

    const onChangePassword = (e) => {
        setUser({...user, password: e.target.value});
    }

    const HandleLogin = async (e) => {
        e.preventDefault();
        handleLogin(user)
            .then((() => {
                addToast({
                    title: 'Sucesso',
                    text: 'Login realizado com sucesso',
                    color: 'success',
                    position: 'top-right',
                    autohide: 3500
                });
            }))
            .catch(()=>{
                addToast({
                    title: 'Erro',
                    text: 'Erro ao realizar Login',
                    color: 'danger',
                    position: 'top-right',
                    autohide: 3500
                });
            })
        setUser({})
    }

    const addToast = (toast) => {
        setToasts( [...toasts, toast]);
    }

    useEffect(() => {
        if (authenticated) {
            history.push("/")
        }
    }, [authenticated])

    return (
        <>
            <Toaster toasts={toasts}/>

            <div className="c-app c-default-layout flex-row align-items-center">
                <Container>
                    <Row className="justify-content-center">
                        <Col md="8">
                            <CardGroup>
                                <Card className="p-4">
                                    <CardBody>
                                        <Form onSubimit={HandleLogin}>
                                            <h1>SISCOEP</h1>
                                            <p className="text-muted">Sistema de Controle de Equipamentos</p>
                                            <InputGroup className="mb-3">
                                                <InputGroupPrepend>
                                                    <InputGroupText>
                                                        <Icon name="cil-user"/>
                                                    </InputGroupText>
                                                </InputGroupPrepend>
                                                <Input type="text" placeholder="UsuÃ¡rio" autoComplete="username"
                                                        onChange={onChangeUsername}
                                                        value={user.login ?? ""}/>
                                            </InputGroup>
                                            <InputGroup className="mb-4">
                                                <InputGroupPrepend>
                                                    <InputGroupText>
                                                        <Icon name="cil-lock-locked"/>
                                                    </InputGroupText>
                                                </InputGroupPrepend>
                                                <Input type="password" placeholder="Senha"
                                                        autoComplete="current-password"
                                                        onChange={onChangePassword}
                                                        value={user.password ?? ""}/>
                                            </InputGroup>
                                            <Row>
                                                <Col xs="6">
                                                    <Button type="submit" color="primary" className="px-4"
                                                             onClick={HandleLogin}>
                                                        Login</Button>
                                                </Col>
                                                <Col xs="6" className="text-right">
                                                    {/*<CButton color="link" className="px-0">Esqueci minha senha</CButton>*/}
                                                </Col>
                                            </Row>
                                        </Form>
                                    </CardBody>
                                </Card>
                                <Card className="py-5 d-md-down-none" style={{width: '44%'}}>
                                    <CardBody className="text-center">
                                        <img style={{maxWidth: '60%', height: 'auto'}} src={bodeverde} alt={'Bode Verde'}/>
                                    </CardBody>
                                </Card>
                            </CardGroup>
                        </Col>
                    </Row>
                </Container>
            </div>
        </>
    )
}

export default Login